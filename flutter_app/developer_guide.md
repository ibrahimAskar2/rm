# دليل المطور لتطبيق فريق الأنصار

## مقدمة

هذا الدليل مخصص للمطورين الذين سيعملون على تطوير وصيانة تطبيق "فريق الأنصار". يوفر هذا الدليل معلومات تفصيلية عن هيكل المشروع، والتقنيات المستخدمة، وكيفية إعداد بيئة التطوير، وإرشادات للتطوير المستقبلي.

## التقنيات المستخدمة

- **لغة البرمجة**: Dart
- **إطار العمل**: Flutter
- **قاعدة البيانات**: Firebase Firestore
- **المصادقة**: Firebase Authentication
- **التخزين**: Firebase Storage
- **الإشعارات**: Firebase Cloud Messaging
- **المصادقة بالبصمة**: Local Auth Package

## هيكل المشروع

```
ansar_app/
├── android/                  # ملفات خاصة بنظام Android
├── assets/                   # الأصول (الصور، الخطوط، إلخ)
│   ├── logo.jpg             # شعار التطبيق
│   └── fonts/               # الخطوط المستخدمة
├── lib/                      # كود المصدر الرئيسي
│   ├── main.dart            # نقطة الدخول الرئيسية للتطبيق
│   ├── models/              # نماذج البيانات
│   ├── screens/             # شاشات التطبيق
│   ├── services/            # خدمات التطبيق (المصادقة، قاعدة البيانات، إلخ)
│   ├── providers/           # مزودي حالة التطبيق
│   ├── widgets/             # عناصر واجهة المستخدم القابلة لإعادة الاستخدام
│   └── utils/               # أدوات مساعدة
├── pubspec.yaml             # تبعيات المشروع
└── test/                    # اختبارات الوحدة والتكامل
```

## إعداد بيئة التطوير

### المتطلبات الأساسية

1. تثبيت Flutter SDK:
   ```bash
   git clone https://github.com/flutter/flutter.git
   export PATH="$PATH:`pwd`/flutter/bin"
   flutter doctor
   ```

2. تثبيت Android Studio:
   - قم بتنزيل وتثبيت Android Studio من [الموقع الرسمي](https://developer.android.com/studio).
   - قم بتثبيت Flutter و Dart plugins من خلال Preferences > Plugins.

3. إعداد مشروع Firebase:
   - قم بإنشاء مشروع جديد في [Firebase Console](https://console.firebase.google.com/).
   - قم بإضافة تطبيق Android وتنزيل ملف google-services.json.
   - ضع ملف google-services.json في المسار android/app/.

### تشغيل المشروع

1. استنساخ المشروع:
   ```bash
   git clone <رابط المستودع>
   cd ansar_app
   ```

2. تثبيت التبعيات:
   ```bash
   flutter pub get
   ```

3. تشغيل التطبيق:
   ```bash
   flutter run
   ```

## هيكل قاعدة البيانات

### جدول المستخدمين (users)

| الحقل | النوع | الوصف |
|-------|------|-------|
| uid | string | معرف المستخدم الفريد |
| email | string | البريد الإلكتروني |
| name | string | الاسم الكامل |
| role | string | الدور (مشرف/موظف) |
| photoURL | string | رابط الصورة الشخصية |
| phoneNumber | string | رقم الهاتف |
| createdAt | timestamp | تاريخ إنشاء الحساب |
| lastLogin | timestamp | تاريخ آخر تسجيل دخول |

### جدول الحضور (attendance)

| الحقل | النوع | الوصف |
|-------|------|-------|
| id | string | معرف فريد |
| userId | string | معرف المستخدم |
| checkInTime | timestamp | وقت تسجيل الدخول |
| checkOutTime | timestamp | وقت تسجيل الخروج |
| date | string | التاريخ (YYYY-MM-DD) |
| status | string | الحالة (حاضر/غائب/متأخر) |

### جدول الدردشات (chats)

| الحقل | النوع | الوصف |
|-------|------|-------|
| id | string | معرف فريد |
| type | string | النوع (فردي/مجموعة) |
| name | string | اسم المجموعة (للمجموعات فقط) |
| participants | array | قائمة معرفات المشاركين |
| createdAt | timestamp | تاريخ إنشاء الدردشة |
| lastMessage | map | آخر رسالة (النص، الوقت، المرسل) |

### جدول الرسائل (messages)

| الحقل | النوع | الوصف |
|-------|------|-------|
| id | string | معرف فريد |
| chatId | string | معرف الدردشة |
| senderId | string | معرف المرسل |
| type | string | نوع الرسالة (نص/صورة/صوت) |
| content | string | محتوى الرسالة |
| timestamp | timestamp | وقت الإرسال |
| readBy | array | قائمة معرفات المستخدمين الذين قرأوا الرسالة |

### جدول الإشعارات (notifications)

| الحقل | النوع | الوصف |
|-------|------|-------|
| id | string | معرف فريد |
| userId | string | معرف المستخدم المستهدف (null للإشعارات العامة) |
| title | string | عنوان الإشعار |
| body | string | نص الإشعار |
| type | string | نوع الإشعار |
| timestamp | timestamp | وقت الإشعار |
| read | boolean | حالة القراءة |

## خدمات التطبيق

### خدمة المصادقة (AuthService)

توفر هذه الخدمة وظائف المصادقة الأساسية:

- تسجيل المستخدمين
- تسجيل الدخول باستخدام البريد الإلكتروني وكلمة المرور
- تسجيل الدخول باستخدام البصمة
- تسجيل الخروج
- استعادة كلمة المرور
- التحقق من حالة المصادقة

### خدمة تسجيل الحضور (AttendanceService)

توفر هذه الخدمة وظائف تسجيل الحضور:

- تسجيل الدخول
- تسجيل الخروج
- الحصول على سجلات الحضور
- حساب إحصائيات الحضور
- تحديد الموظف المميز (أول من يحضر)

### خدمة الدردشة (ChatService)

توفر هذه الخدمة وظائف الدردشة:

- إنشاء دردشات فردية ومجموعات
- إرسال واستقبال الرسائل النصية
- إرسال واستقبال الرسائل الصوتية
- إرسال واستقبال الصور
- تتبع حالة قراءة الرسائل
- البحث في المحادثات

### خدمة الإحصائيات (StatisticsService)

توفر هذه الخدمة وظائف الإحصائيات:

- الحصول على الموظفين المتواجدين حالياً
- حساب عدد الغياب
- حساب إحصائيات الدوام (يومي/أسبوعي/شهري/سنوي)
- معرفة عدد دوام موظف معين

## مزودي حالة التطبيق

### مزود المستخدم (UserProvider)

يدير حالة المستخدم الحالي ويوفر واجهة سهلة الاستخدام للتعامل مع خدمة المصادقة.

### مزود تسجيل الحضور (AttendanceProvider)

يدير حالة الحضور ويوفر واجهة سهلة الاستخدام للتعامل مع خدمة تسجيل الحضور.

### مزود الدردشة (ChatProvider)

يدير حالة الدردشات والرسائل ويوفر واجهة سهلة الاستخدام للتعامل مع خدمة الدردشة.

### مزود الإحصائيات (StatisticsProvider)

يدير حالة الإحصائيات ويوفر واجهة سهلة الاستخدام للتعامل مع خدمة الإحصائيات.

## إرشادات التطوير

### أسلوب الكود

- استخدم camelCase لأسماء المتغيرات والدوال.
- استخدم PascalCase لأسماء الفئات والمكونات.
- استخدم snake_case لأسماء الملفات.
- اكتب تعليقات توضيحية للكود المعقد.
- استخدم مسافة بادئة من مسافتين.

### إضافة ميزات جديدة

1. قم بإنشاء فرع جديد لكل ميزة.
2. قم بتنفيذ الميزة وكتابة اختبارات لها.
3. قم بدمج الفرع مع الفرع الرئيسي بعد التأكد من عمل الميزة بشكل صحيح.

### النشر

1. قم بزيادة رقم الإصدار في ملف pubspec.yaml.
2. قم ببناء حزمة APK للإصدار:
   ```bash
   flutter build apk --release
   ```
3. قم باختبار الحزمة على أجهزة مختلفة.
4. قم بنشر الحزمة على Google Play Store.

## استكشاف الأخطاء وإصلاحها

### مشاكل المصادقة

- تأكد من تكوين Firebase Authentication بشكل صحيح.
- تحقق من صحة البريد الإلكتروني وكلمة المرور.
- تأكد من تفعيل طرق المصادقة المطلوبة في Firebase Console.

### مشاكل قاعدة البيانات

- تأكد من تكوين Firebase Firestore بشكل صحيح.
- تحقق من قواعد الأمان في Firestore.
- تأكد من صحة هيكل البيانات.

### مشاكل الإشعارات

- تأكد من تكوين Firebase Cloud Messaging بشكل صحيح.
- تحقق من تسجيل الجهاز للإشعارات.
- تأكد من صحة رمز FCM.

## الموارد

- [وثائق Flutter](https://flutter.dev/docs)
- [وثائق Firebase](https://firebase.google.com/docs)
- [وثائق Dart](https://dart.dev/guides)
- [مستودع المشروع](https://github.com/yourusername/ansar_app)

## معلومات الاتصال

للاستفسارات أو الإبلاغ عن المشكلات، يرجى التواصل مع:

- **المطور**: إبراهيم عسكر
